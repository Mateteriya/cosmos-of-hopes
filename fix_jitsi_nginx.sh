#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –¥–ª—è Jitsi

set -e

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –¥–ª—è Jitsi..."

# 1. –í—ã–π—Ç–∏ –∏–∑ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –ù–∞–∂–º–∏—Ç–µ Ctrl+C –µ—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–ª–∏

# 2. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Jitsi
mkdir -p /etc/jitsi/meet

# 3. –°–æ–∑–¥–∞—Ç—å —Å–∏–º–ª–∏–Ω–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–ª–∏–Ω–∫–æ–≤ –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã..."
ln -sf /var/lib/prosody/meet.super2026.online.crt /etc/jitsi/meet/meet.super2026.online.crt
ln -sf /var/lib/prosody/meet.super2026.online.key /etc/jitsi/meet/meet.super2026.online.key

# 4. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—É–±—Ä–∞—Ç—å –∫–∞–≤—ã—á–∫–∏ –∏–∑ –∏–º–µ–Ω–∏)
echo "üìù –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if [ -f "/etc/nginx/sites-enabled/\`meet.super2026.online\`.conf" ]; then
    mv "/etc/nginx/sites-enabled/\`meet.super2026.online\`.conf" /etc/nginx/sites-enabled/meet.super2026.online.conf
    echo "‚úÖ –§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω"
fi

# 5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
if [ -f "/etc/nginx/sites-enabled/meet.super2026.online.conf" ]; then
    echo "üî® –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
    sed -i 's/`meet\.super2026\.online`/meet.super2026.online/g' /etc/nginx/sites-enabled/meet.super2026.online.conf
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞"
fi

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx..."
nginx -t

# 7. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å nginx
echo "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx..."
systemctl reload nginx

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! Nginx –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–ø–µ—Ä—å."

