# üé§ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —á–∞—Ç–∞ (WebRTC)

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç –Ω–∞ WebRTC —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∫–∞–∫ –≤ Zoom/Telegram.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–æ–≤—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
- ‚úÖ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞ (48kHz, echo cancellation, noise suppression)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö STUN —Å–µ—Ä–≤–µ—Ä–æ–≤ (Google –∏ –¥—Ä—É–≥–∏–µ)
- ‚úÖ –°–∏–≥–Ω–∞–ª–∏–Ω–≥ —á–µ—Ä–µ–∑ Supabase Realtime (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫)

## –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase Dashboard ‚Üí SQL Editor:

```sql
-- –§–∞–π–ª: supabase/migration_add_webrtc_signaling.sql
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `webrtc_signaling` –¥–ª—è –æ–±–º–µ–Ω–∞ WebRTC —Å–∏–≥–Ω–∞–ª–∞–º–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.

### 2. –í–∫–ª—é—á–∏—Ç—å Realtime –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã

–í Supabase Dashboard:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Replication**
2. –ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `webrtc_signaling`
3. –í–∫–ª—é—á–∏—Ç–µ Realtime –¥–ª—è –Ω–µ—ë (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω)

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL:
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE webrtc_signaling;
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã (–æ–Ω–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –º–∏–≥—Ä–∞—Ü–∏–∏).

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç** ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
2. **–ü–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–Ω–∞—Ç—ã** ‚Üí —Å–æ–∑–¥–∞—é—Ç—Å—è peer connections –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
3. **–û–±–º–µ–Ω SDP offers/answers** ‚Üí —á–µ—Ä–µ–∑ Supabase Realtime (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
4. **–û–±–º–µ–Ω ICE candidates** ‚Üí –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** ‚Üí –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–ª–∏ –æ–±—Ä—ã–≤–∞—Ö

## STUN —Å–µ—Ä–≤–µ—Ä—ã

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ STUN —Å–µ—Ä–≤–µ—Ä—ã –æ—Ç Google –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

### –ï—Å–ª–∏ –Ω—É–∂–Ω—ã TURN —Å–µ—Ä–≤–µ—Ä—ã (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö NAT)

–î–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ STUN –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (—Å—Ç—Ä–æ–≥–∏–π NAT, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ç–∏), –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å TURN —Å–µ—Ä–≤–µ—Ä—ã:

**–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- [Twilio STUN/TURN](https://www.twilio.com/stun-turn) - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier
- [Xirsys](https://xirsys.com/) - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier
- [Metered TURN](https://www.metered.ca/tools/openrelay/) - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier

**–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π TURN —Å–µ—Ä–≤–µ—Ä:**
–ú–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π —á–µ—Ä–µ–∑ [coturn](https://github.com/coturn/coturn) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: < 100ms (–ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ)
- **–ö–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞**: 48kHz, —Å—Ç–µ—Ä–µ–æ
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**: –¥–æ 10-15 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: echo cancellation, noise suppression, auto gain control

## –û—Ç–ª–∞–¥–∫–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥—É—Ç –ª–æ–≥–∏:
- `üîó –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å [userId]: [state]` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω` - —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –í–∏–¥–µ–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –≠–∫—Ä–∞–Ω–Ω–æ–µ –≤–µ—â–∞–Ω–∏–µ
- [ ] –ó–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥–æ–≤–æ—Ä—è—â–µ–≥–æ
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (—ç—Ö–æ, —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—è –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã)

## –í–∞–∂–Ω–æ

–≠—Ç–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** –¥–ª—è –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- Supabase Realtime - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier
- STUN —Å–µ—Ä–≤–µ—Ä—ã - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
- WebRTC - –≤—Å—Ç—Ä–æ–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä—ã

–ù–∏–∫–∞–∫–∏—Ö –ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è! üéâ
