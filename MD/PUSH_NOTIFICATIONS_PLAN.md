# üì± –ü–ª–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **31 –¥–µ–∫–∞–±—Ä—è –≤ 23:57** –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã —à–∞—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ –∫–æ—Å–º–æ—Å
2. **31 –¥–µ–∫–∞–±—Ä—è –≤ 22:50** –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –∫–æ–º–Ω–∞—Ç, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Supabase Edge Functions (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫**: –í —Ç–∞–±–ª–∏—Ü–µ `push_subscriptions` (—É–∂–µ –µ—Å—Ç—å)
2. **Edge Function**: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cron job –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitHub Actions, Vercel Cron)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–π Node.js —Å–µ—Ä–≤–µ—Ä

1. **–°–µ—Ä–≤–µ—Ä**: Node.js —Å express
2. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**: node-cron
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–í–∞—Ä–∏–∞–Ω—Ç 1 - Supabase)

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å Edge Function –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–§–∞–π–ª: `supabase/functions/send-push-notification/index.ts`

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –õ–æ–≥–∏–∫—É –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —à–∞—Ä–∞–º–∏ –Ω–∞ —ë–ª–∫–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞—Ç–µ–ª—è–º –∫–æ–º–Ω–∞—Ç
- –û—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

–í–∞—Ä–∏–∞–Ω—Ç—ã:
1. **GitHub Actions** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
2. **Vercel Cron** (–µ—Å–ª–∏ –¥–µ–ø–ª–æ–π –Ω–∞ Vercel)
3. **–û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä** —Å node-cron

### –®–∞–≥ 3: –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

```typescript
// –ü—Å–µ–≤–¥–æ–∫–æ–¥
async function sendNewYearNotifications() {
  const now = new Date();
  
  // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
  for (const subscription of subscriptions) {
    const userTime = getUserLocalTime(subscription.user_id);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —à–∞—Ä –Ω–∞ —ë–ª–∫–µ
    const hasBall = await checkUserHasBall(subscription.user_id);
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ 23:57
    if (userTime.getHours() === 23 && userTime.getMinutes() === 57 && hasBall) {
      await sendNotification(subscription, {
        title: "–ß–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã –≤–∞—à —à–∞—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ –∫–æ—Å–º–æ—Å!",
        body: "–ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –≤–æ–ª—à–µ–±–Ω—ã–π –º–æ–º–µ–Ω—Ç - –≤–∞—à —à–∞—Ä —Å –∂–µ–ª–∞–Ω–∏–µ–º —Å–∫–æ—Ä–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ –∫–æ—Å–º–æ—Å 2026+ –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è!",
      });
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–∑–¥–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–Ω–∞—Ç—É
    const hasRoom = await checkUserCreatedRoom(subscription.user_id);
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ 22:50
    if (userTime.getHours() === 22 && userTime.getMinutes() === 50 && hasRoom) {
      await sendNotification(subscription, {
        title: "–í—Ä–µ–º—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞—à—É –∫–æ–º–Ω–∞—Ç—É!",
        body: "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞—à—É –∫–æ–º–Ω–∞—Ç—É –¥–ª—è –ø—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏—è –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞ –∏ –Ω–∞–ø–æ–º–Ω–∏—Ç—å –≤—Å–µ–º –≥–æ—Å—Ç—è–º –æ –Ω–∞—á–∞–ª–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è!",
      });
    }
  }
}
```

## –í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Edge Function: 1-2 —á–∞—Å–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞: 30 –º–∏–Ω—É—Ç - 1 —á–∞—Å
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 1 —á–∞—Å

**–ò—Ç–æ–≥–æ: 2.5-4 —á–∞—Å–∞**

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –ª–æ–≥–∏–∫—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

1. –í `NotificationManager` –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º—è
2. –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –≤—Ä–µ–º—è - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π API
3. –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–Ω–ª–∞–π–Ω

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–ù–∞—á–∞—Ç—å —Å —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞), –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

