# üîß –ö–ê–ö –ò–°–ü–†–ê–í–ò–¢–¨ –ü–†–û–ë–õ–ï–ú–£ –° SQL

## ‚ùå –ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:

–í—ã —Å–ª—É—á–∞–π–Ω–æ –∑–∞–º–µ–Ω–∏–ª–∏ **–æ—Å–Ω–æ–≤–Ω–æ–π SQL –∫–æ–¥** (–∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã) –Ω–∞ **–∫–æ–¥ –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫ Storage**. –≠—Ç–æ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏!

## ‚úÖ –†–µ—à–µ–Ω–∏–µ:

–ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–î–í–ê –û–¢–î–ï–õ–¨–ù–´–• SQL —Å–∫—Ä–∏–ø—Ç–∞**:

1. **–ü–µ—Ä–≤—ã–π —Å–∫—Ä–∏–ø—Ç** - —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥)
2. **–í—Ç–æ—Ä–æ–π —Å–∫—Ä–∏–ø—Ç** - —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Storage (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥)

---

## üìã –®–ê–ì 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü)

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí SQL Editor**

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
   - `cosmos-of-hopes/supabase/RESTORE_ORIGINAL_SCHEMA.sql`
   - –ò–ª–∏ `cosmos-of-hopes/supabase/schema.sql`

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–Å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞** (Ctrl+A, Ctrl+C)

4. **–í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –≤ Supabase** (Ctrl+V)

5. **–ù–∞–∂–º–∏—Ç–µ Run** (–∏–ª–∏ Ctrl+Enter)

6. **–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Success"** ‚úÖ

**–≠—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã!**

---

## üìã –®–ê–ì 2: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Storage (–æ—Ç–¥–µ–ª—å–Ω–æ!)

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–í SQL Editor —Å–æ–∑–¥–∞–π—Ç–µ –ù–û–í–´–ô –∑–∞–ø—Ä–æ—Å:**
   - –ù–∞–∂–º–∏—Ç–µ "New query" (–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
   - `cosmos-of-hopes/supabase/storage-policies.sql`

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–Å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** (Ctrl+A, Ctrl+C)

4. **–í—Å—Ç–∞–≤—å—Ç–µ –≤ –ù–û–í–´–ô –∑–∞–ø—Ä–æ—Å –≤ SQL Editor** (Ctrl+V)

5. **–ù–∞–∂–º–∏—Ç–µ Run** (–∏–ª–∏ Ctrl+Enter)

6. **–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Success"** ‚úÖ

**–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!**

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã:
- –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí **Table Editor**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã —Ç–∞–±–ª–∏—Ü—ã:
  - ‚úÖ `toys`
  - ‚úÖ `rooms`
  - ‚úÖ `user_profiles`
  - ‚úÖ `room_members`

### 2. –ü–æ–ª–∏—Ç–∏–∫–∏ Storage —Å–æ–∑–¥–∞–Ω—ã:
- –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí **SQL Editor**
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:

```sql
SELECT pol.polname AS policy_name
FROM pg_policy pol
JOIN pg_class c ON pol.polrelid = c.oid
JOIN pg_namespace n ON c.relnamespace = n.oid
WHERE n.nspname = 'storage' AND c.relname = 'objects';
```

- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏:
  - ‚úÖ "Anyone can upload images"
  - ‚úÖ "Anyone can read images"
  - ‚úÖ "Anyone can update images"
  - ‚úÖ "Anyone can delete images"

---

## üéØ –í–ê–ñ–ù–û –ü–û–ù–ò–ú–ê–¢–¨

### –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö SQL —Å–∫—Ä–∏–ø—Ç–∞:

1. **`schema.sql`** (–∏–ª–∏ `RESTORE_ORIGINAL_SCHEMA.sql`)
   - –°–æ–∑–¥–∞–µ—Ç **—Ç–∞–±–ª–∏—Ü—ã** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –°–æ–∑–¥–∞–µ—Ç **—Ç—Ä–∏–≥–≥–µ—Ä—ã** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –°–æ–∑–¥–∞–µ—Ç **–ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –¥–ª—è —Ç–∞–±–ª–∏—Ü
   - **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó** –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

2. **`storage-policies.sql`**
   - –°–æ–∑–¥–∞–µ—Ç **–ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Storage** (—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ñ–∞–π–ª–æ–≤)
   - –ù—É–∂–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –û–¢–î–ï–õ–¨–ù–û**, –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

### –ù–ï –ó–ê–ú–ï–ù–Ø–ô–¢–ï –æ–¥–∏–Ω –Ω–∞ –¥—Ä—É–≥–æ–π!

–û–Ω–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–û–ë–ê**, –Ω–æ **–û–¢–î–ï–õ–¨–ù–û**:
- –°–Ω–∞—á–∞–ª–∞ `schema.sql` - —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã
- –ü–æ—Ç–æ–º `storage-policies.sql` - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Storage

---

## üö® –ï–°–õ–ò –í–û–ó–ù–ò–ö–õ–ò –û–®–ò–ë–ö–ò

### –û—à–∏–±–∫–∞: "—Ç—Ä–∏–≥–≥–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –°–∫—Ä–∏–ø—Ç `RESTORE_ORIGINAL_SCHEMA.sql` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `DROP TRIGGER IF EXISTS`, –ø–æ—ç—Ç–æ–º—É —ç—Ç–∞ –æ—à–∏–±–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è.

–ï—Å–ª–∏ –≤—Å—ë –∂–µ –ø–æ—è–≤–∏–ª–∞—Å—å:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞:

```sql
DROP TRIGGER IF EXISTS update_toys_updated_at ON toys;
DROP TRIGGER IF EXISTS update_rooms_updated_at ON rooms;
DROP TRIGGER IF EXISTS update_user_profiles_updated_at ON user_profiles;
```

2. –ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `RESTORE_ORIGINAL_SCHEMA.sql`

### –û—à–∏–±–∫–∞: "–ø–æ–ª–∏—Ç–∏–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

–≠—Ç–æ —Ç–æ–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –°–∫—Ä–∏–ø—Ç `storage-policies.sql` —Å–æ–¥–µ—Ä–∂–∏—Ç `DROP POLICY IF EXISTS`, –ø–æ—ç—Ç–æ–º—É —ç—Ç–∞ –æ—à–∏–±–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è.

---

## ‚úÖ –ü–û–°–õ–ï –í–°–ï–ì–û

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (Ctrl+C)
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞
   npm run dev
   ```

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É—à–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - –í —Ç–∞–±–ª–∏—Ü–µ `toys` –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å
   - –í Storage `toy-images` –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## üìû –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

–°–æ–æ–±—â–∏—Ç–µ –º–Ω–µ:
1. –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –ø–æ—è–≤–∏–ª–∏—Å—å (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. –ß—Ç–æ –≤–∏–¥–Ω–æ –≤ Table Editor (–∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –µ—Å—Ç—å)
3. –ß—Ç–æ –≤–∏–¥–Ω–æ –≤ Storage (–µ—Å—Ç—å –ª–∏ bucket `toy-images`)

–Ø –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üîß


