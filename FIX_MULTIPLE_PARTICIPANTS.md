# Исправление проблемы: сессия завершается при входе второго участника

## Проблема
Когда второй участник заходит в комнату, сессия сразу прерывается. Невозможно быть двум участникам одновременно.

## Причины
1. **Дублирование настроек P2P** в конфигурации Jitsi (два блока `p2p` конфликтуют)
2. **Одинаковые имена пользователей** - если оба устройства используют один `currentUserId`, Jitsi может считать это одним пользователем

## Исправления

### 1. Исправлен код приложения ✅
- Добавлен уникальный идентификатор для каждого подключения
- Имена пользователей теперь различаются даже при одном `currentUserId`

### 2. Нужно исправить конфигурацию на сервере

Выполните на сервере (после подключения через SSH):

```bash
# 1. Создать резервную копию
cp /etc/jitsi/meet/meet.super2026.online-config.js /etc/jitsi/meet/meet.super2026.online-config.js.backup2

# 2. Удалить первый блок p2p (строки примерно 1090-1128)
# Откройте файл в редакторе
nano /etc/jitsi/meet/meet.super2026.online-config.js

# Найдите первый блок:
#     p2p: {
#         enabled: true,
#         ...
#     },
#
# И замените его на комментарий:
#     // P2P настройки перенесены ниже в конфиге
#     // Первый блок p2p удален, чтобы избежать конфликтов

# Или используйте sed для автоматического удаления:
sed -i '/^    p2p: {$/,/^    },$/c\    // P2P настройки перенесены ниже в конфиге\n    // Первый блок p2p удален, чтобы избежать конфликтов' /etc/jitsi/meet/meet.super2026.online-config.js

# 3. Проверить синтаксис
node -c /etc/jitsi/meet/meet.super2026.online-config.js

# 4. Перезапустить Jitsi сервисы
systemctl restart jitsi-videobridge2
systemctl restart prosody
```

### Альтернативный способ (вручную через nano)

1. Откройте файл:
```bash
nano /etc/jitsi/meet/meet.super2026.online-config.js
```

2. Найдите строку `p2p: {` (примерно строка 1090)

3. Удалите весь блок от `p2p: {` до закрывающей `},` (примерно строки 1090-1128)

4. Замените на комментарий:
```javascript
    // P2P настройки перенесены ниже в конфиге
    // Первый блок p2p удален, чтобы избежать конфликтов
```

5. Сохраните: `Ctrl+O`, `Enter`, `Ctrl+X`

6. Проверьте синтаксис:
```bash
node -c /etc/jitsi/meet/meet.super2026.online-config.js
```

## После исправления

1. **Обновите код приложения** на сервере (если еще не обновлен)
2. **Перезапустите приложение** (если используете PM2 или другой менеджер процессов)
3. **Проверьте работу**: зайдите с двух устройств в одну комнату

## Что было исправлено в коде

1. **Добавлен уникальный идентификатор сессии** для каждого подключения
2. **Имена пользователей теперь уникальны** даже при одном `currentUserId`
3. **Удален конфликтующий блок P2P** из конфигурации

Теперь каждый участник будет иметь уникальное имя, и Jitsi не будет считать их одним пользователем.

